<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Data Cleaner</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"> -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .checkbox-md {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">
    <header class="bg-white shadow">
        <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <h1 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Vipplav.ai CAL Tool <V1 class="5"></V1></h1>
            </div>
        </div>
    </header>
    

    <div id="notification-container" class="fixed bottom-0 right-0 m-4 space-y-2"></div>

    <main class="container mx-auto p-4 sm:p-8">
        <div class="bg-white shadow-md rounded px-4 sm:px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="file-upload">
                    Choose your json file
                </label>
                <input type="file" id="file-upload" name="file-upload"
                    class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <button id="upload-button"
                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2">
                    Upload
                </button>
            </div>
            <div id="content-area" class="mb-4 hidden">
                <div class="mb-4">
                    <p id="title-top" class="text-gray-700 text-sm font-bold mb-2">Title: -</p>
                    <button id="open-page-button-top"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Open Page
                    </button>
                </div>
                <div class="mb-4">
                    <p class="text-gray-700 text-sm font-bold mb-2">CONTENT:</p>
                    <div id="content-list" class="mb-4">
                    </div>
                </div>
                <div class="flex items-center justify-between mb-4">
                    <button id="delete-button"
                        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Delete
                    </button>

                    <button id="undo-button"
                        class="bg-orange-500 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Undo
                    </button>

                    <button id="skip-button"
                        class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Skip
                    </button>
                </div>
                <div class="mb-4">
                    <p id="title-bottom" class="text-gray-700 text-sm font-bold mb-2">Title: -</p>
                    <button id="open-page-button-bottom"
                        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Open Page
                    </button>
                </div>
                <div id="dropdowns" class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <div class="flex flex-col mb-4 sm:mb-0">
                        <label for="category" class="text-gray-700 text-sm font-bold mb-2">Category:</label>
                        <select id="category" name="category" class="bg-white shadow border rounded py-2 px-3 w-full">
                            <option value="">Select a category</option>
                            <option value="">General</option>
                            <option value="Story">Story</option>
                            <option value="Politics">Politics</option>
                            <option value="Health and lifestyle">Health and lifestyle</option>
                            <option value="Sports">Sports</option>
                            <option value="Finance and Business">Finance and Business</option>
                            <option value="Spiritual">Spiritual</option>
                            <option value="Technology and space">Technology and space</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Crime">Crime</option>
                            <option value="Medicine">Medicine</option>
                            <option value="Unique">Unique</option>
                            <option value="Nature and animals">Nature and animals</option>
                            <option value="Foregin affiars">Forgien affiars</option>
                            <option value="Motivation">Motivation</option>
                            <option value="Education and Jobs">Education and Jobs</option>

                            <!-- ...other options... -->
                        </select>
                    </div>
                    <div class="flex flex-col">
                        <label for="sentiment" class="text-gray-700 text-sm font-bold mb-2">Sentiment:</label>
                        <select id="sentiment" name="sentiment" class="bg-white shadow border rounded py-2 px-3 w-full">
                            <option value="">Select Sentiment</option>
                            <option value="Positive">Positive</option>
                            <option value="Neutral">Neutral</option>
                            <option value="Negative">Negative</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <button id="previous-button"
                        class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Previous
                    </button>
                    <button id="save-and-next-button"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Save and Next
                    </button>
                </div>
                    <button id="download-button"
                        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline absolute top-0 right-0 m-4">
                        Download Results
                    </button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let originalFileName = '';
    
            document.getElementById('upload-button').addEventListener('click', function() {
                const fileInput = document.getElementById('file-upload');
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    originalFileName = file.name.split('.').slice(0, -1).join('.');
    
                    const fileReader = new FileReader();
                    fileReader.onload = function(e) {
                        const content = JSON.parse(e.target.result);
                        window.currentItemIndex = 0;
                        window.jsonContent = content.map(item => ({...item, saved: false, skipped: false}));
                        displayItem(window.currentItemIndex);
                    };
                    fileReader.readAsText(file);
                }
            });
    
            function displayItem(index) {
                const item = window.jsonContent[index];
                if (!item) return;

                if (!item.originalContent) {
                    item.originalContent = JSON.parse(JSON.stringify(item.content));
                }

                document.getElementById('title-top').textContent = `Item ${index + 1} of ${window.jsonContent.length}: ${item.title}`;
                document.getElementById('title-bottom').textContent = `Item ${index + 1} of ${window.jsonContent.length}: ${item.title}`;
                document.getElementById('open-page-button-top').onclick = () => window.open(item.href, '_blank');
                document.getElementById('open-page-button-bottom').onclick = () => window.open(item.href, '_blank');

                const contentList = document.getElementById('content-list');
    
                // Clear existing content first
                contentList.innerHTML = '';

                // Create and prepend the "Select All" checkbox
                const selectAllCheckbox = document.createElement('input');
                selectAllCheckbox.type = 'checkbox';
                selectAllCheckbox.id = 'select-all-checkbox';
                selectAllCheckbox.className = 'checkbox-md';
                selectAllCheckbox.addEventListener('change', function() {
                    const checkboxes = document.querySelectorAll('.content-checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                });

                const selectAllLabel = document.createElement('label');
                selectAllLabel.htmlFor = 'select-all-checkbox';
                selectAllLabel.textContent = 'Select All';
                selectAllLabel.className = 'mr-2'; // Adjust as needed

                const selectAllDiv = document.createElement('div');
                selectAllDiv.appendChild(selectAllCheckbox);
                selectAllDiv.appendChild(selectAllLabel);
                
                contentList.prepend(selectAllDiv);

                item.content.forEach((content, i) => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'checkbox-md content-checkbox'; // Ensure this matches the selector in the "Select All" listener
                    checkbox.id = `checkbox-${index}-${i}`;

                    const label = document.createElement('label');
                    label.htmlFor = checkbox.id;
                    label.textContent = content;
                    label.className = 'ml-2'; // Adjust styling as needed

                    const container = document.createElement('div');
                    container.appendChild(checkbox);
                    container.appendChild(label);

                    contentList.appendChild(container);
                });

                document.getElementById('content-area').style.display = 'block';
                document.getElementById('dropdowns').style.display = 'flex';

                const categorySelect = document.getElementById('category');
                categorySelect.value = item.category || "Story";

                const sentimentSelect = document.getElementById('sentiment');
                sentimentSelect.value = item.sentiment || "Neutral";
                }

                document.getElementById('delete-button').addEventListener('click', function() {
                const contentList = document.getElementById('content-list');
                const checkboxes = contentList.querySelectorAll('input[type=checkbox]:not(#select-all-checkbox)'); // Select all except the Select All checkbox
                const newContent = [];
                const selectAllCheckbox = document.getElementById('select-all-checkbox');

                // Iterate over checkboxes to determine which items to keep
                checkboxes.forEach((checkbox, index) => {
                    if (!checkbox.checked) {
                        newContent.push(window.jsonContent[window.currentItemIndex].content[index]);
                    }
                });

                // Update the content for the current item and reset the Select All checkbox
                window.jsonContent[window.currentItemIndex].content = newContent;
                selectAllCheckbox.checked = false; // Reset Select All checkbox

                // Re-display the item to update the UI
                displayItem(window.currentItemIndex);
                });


                document.getElementById('save-and-next-button').addEventListener('click', function() {
                const currentItem = window.jsonContent[window.currentItemIndex];
                currentItem.category = document.getElementById('category').value;
                currentItem.sentiment = document.getElementById('sentiment').value;
                currentItem.saved = true;
                window.currentItemIndex++;
                if (window.currentItemIndex < window.jsonContent.length) {
                    displayItem(window.currentItemIndex);
                    notify('Item saved, moving to next.', 'bg-green-500');
                } else {
                    notify('No more items to display.', 'bg-orange-500');
                }
                });

                document.getElementById('previous-button').addEventListener('click', function() {
                if (window.currentItemIndex > 0) {
                    window.currentItemIndex--;
                    displayItem(window.currentItemIndex);
                    notify('Moved to previous item.', 'bg-blue-500');
                }
                });

                document.getElementById('skip-button').addEventListener('click', function() {
                window.jsonContent[window.currentItemIndex].skipped = true;
                window.currentItemIndex++;
                if (window.currentItemIndex < window.jsonContent.length) {
                    displayItem(window.currentItemIndex);
                    notify('Item skipped.', 'bg-yellow-500');
                } else {
                    notify('No more items to display.', 'bg-orange-500');
                }
                });
                
                document.getElementById('undo-button').addEventListener('click', function() {
                undoChanges();
                });

            

                document.getElementById('download-button').addEventListener('click', function() {
                // Filter out 'saved' items and remove 'originalContent' from each item
                const cleanedData = window.jsonContent.filter(item => item.saved).map(item => {
                    const {originalContent, ...cleanedItem} = item; // Destructure to exclude originalContent
                    return cleanedItem;
                });

                // Optional: If you want to include skipped items in a separate file, apply similar logic to remove 'originalContent'
                const skippedData = window.jsonContent.filter(item => item.skipped).map(item => {
                    const {originalContent, ...skippedItem} = item;
                    return skippedItem;
                });

                downloadJSON(cleanedData, `cleaned_${originalFileName}.json`);
                downloadJSON(skippedData, `skipped_items_${originalFileName}.json`);
                });

                function downloadJSON(data, filename) {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                notify(`Downloading ${filename}...`, 'bg-purple-500');
                }

                function undoChanges() {
                const currentItem = window.jsonContent[window.currentItemIndex];
                if (currentItem.originalContent) {
                    // Revert content to originalContent
                    currentItem.content = JSON.parse(JSON.stringify(currentItem.originalContent));
                    displayItem(window.currentItemIndex);
                    notify('Changes undone, original content restored.', 'bg-gray-500');
                    }
                }


                function notify(message, className = 'bg-blue-500') {
                const notification = document.createElement('div');
                notification.className = `text-white px-4 py-2 rounded ${className} mb-2`;
                notification.textContent = message;
                const container = document.getElementById('notification-container');
                container.appendChild(notification);
                setTimeout(() => notification.remove(), 2000);
                }
                });
                </script>

</body>

</html>
